<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Review AI-generated DJ scripts with a swipe interface">
    <meta name="theme-color" content="#1a1a1a">
    <title>DJ Script Review</title>
    
    <!-- Tailwind CSS - Local Build (v3) -->
    <link rel="stylesheet" href="/static/tailwind.min.css">
    
    <!-- Custom styles -->
    <style>
        body {
            overflow-x: hidden;
            touch-action: pan-y;
        }
        
        .card-container {
            perspective: 1000px;
            position: relative;
            width: 100%;
            max-width: 500px;
            min-height: 400px;
            margin: 0 auto;
        }
        
        .review-card {
            position: relative;
            width: 100%;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.3s ease, opacity 0.3s ease;
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
        }
        
        .review-card:active {
            cursor: grabbing;
        }
        
        .review-card.swiping {
            transition: none;
        }
        
        /* Allow scrolling in content area */
        .scrollable-content {
            touch-action: pan-y;
            cursor: default;
            user-select: text;
            -webkit-user-select: text;
        }
        
        .scrollable-content:active {
            cursor: default;
        }
        
        .review-card.approved {
            animation: swipeRight 0.3s ease-out forwards;
        }
        
        .review-card.rejected {
            animation: swipeLeft 0.3s ease-out forwards;
        }
        
        @keyframes swipeRight {
            to {
                transform: translateX(150%) rotate(20deg);
                opacity: 0;
            }
        }
        
        @keyframes swipeLeft {
            to {
                transform: translateX(-150%) rotate(-20deg);
                opacity: 0;
            }
        }
        
        .approve-indicator, .reject-indicator {
            position: absolute;
            top: 50px;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        
        .approve-indicator {
            right: 50px;
        }
        
        .reject-indicator {
            left: 50px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 2000;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* Category Pills */
        .category-pill {
            border: 2px solid transparent;
        }
        
        .category-pill.active {
            border-color: #60a5fa;
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.3);
        }
        
        /* Category Badge */
        .category-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-weather { background-color: #3b82f6; }
        .badge-story { background-color: #8b5cf6; }
        .badge-news { background-color: #ef4444; }
        .badge-gossip { background-color: #f59e0b; }
        .badge-music { background-color: #10b981; }
        .badge-general { background-color: #6b7280; }
        
        /* Accessibility - Focus Indicators */
        button:focus-visible, select:focus-visible, input:focus-visible, textarea:focus-visible {
            outline: 3px solid #60a5fa;
            outline-offset: 2px;
        }
        
        /* Modal Close Button */
        .modal-close {
            min-width: 56px;
            min-height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        /* Advanced Filters Animation */
        #advancedFiltersPanel {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.2s ease, padding 0.3s ease;
        }
        
        #advancedFiltersPanel.expanded {
            max-height: 600px;
            opacity: 1;
        }
        
        /* Category Pills Animation */
        @media (prefers-reduced-motion: no-preference) {
            .category-pill {
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .category-pill:active {
                transform: scale(0.95);
            }
        }
        
        /* Category Pills Grid */
        .category-pills-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            max-width: 48rem;
            margin: 0 auto 1.5rem auto; /* Added bottom margin */
        }
        
        @media (min-width: 768px) {
            .category-pills-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .category-pills-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .category-pill {
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Swipe Hints Fade */
        .swipe-hints.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Larger Swipe Indicators */
        .approve-indicator, .reject-indicator {
            font-size: 6rem;
            font-weight: bold;
            text-shadow: 0 0 20px currentColor;
        }
        
        /* Undo Toast */
        .undo-toast {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        /* Loading Skeleton */
        .skeleton-card {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Hamburger Menu & Sidebar */
        .hamburger {
            width: 30px;
            height: 24px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.3s ease;
        }
        
        .hamburger span {
            display: block;
            height: 3px;
            width: 100%;
            background: white;
            border-radius: 3px;
            transition: all 0.3s ease;
        }
        
        .hamburger.active span:nth-child(1) {
            transform: translateY(10.5px) rotate(45deg);
        }
        
        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger.active span:nth-child(3) {
            transform: translateY(-10.5px) rotate(-45deg);
        }
        
        .sidebar {
            position: fixed;
            top: 0;
            left: -380px;
            width: 380px;
            height: 100vh;
            background: #1f2937;
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            transition: left 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .sidebar.open {
            left: 0;
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 999;
        }
        
        .sidebar-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        @media (max-width: 640px) {
            .sidebar {
                width: 90%;
                left: -90%;
            }
        }
    </style>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">
    
    <!-- App Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/static/icons/icon-192.png">
    <link rel="apple-touch-icon" href="/static/icons/icon-192.png">
</head>
<body class="bg-gray-900 text-white min-h-screen">
    
    <!-- Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>
    
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold">Filters & Actions</h2>
            <button id="closeSidebar" class="text-gray-400 hover:text-white text-2xl" aria-label="Close sidebar">√ó</button>
        </div>
        
        <!-- DJ Selector -->
        <div class="mb-6">
            <label class="block text-sm font-medium mb-2">DJ Filter</label>
            <select id="djFilter" class="w-full bg-gray-800 text-white px-4 py-3 rounded-lg border border-gray-700 focus:outline-none focus:border-blue-500">
                <option value="">All DJs</option>
            </select>
        </div>
        
        <!-- Category Filter Pills -->
        <div class="mb-6">
            <label class="block text-sm font-medium mb-3">Category</label>
            <div class="grid grid-cols-2 gap-3">
                <button data-category="" class="category-pill active bg-blue-600 px-4 py-3 rounded-full text-sm font-medium transition hover:bg-blue-700">
                    All
                </button>
                <button data-category="weather" class="category-pill bg-gray-700 px-4 py-3 rounded-full text-sm font-medium transition hover:bg-gray-600">
                    ‚õàÔ∏è Weather
                </button>
                <button data-category="story" class="category-pill bg-gray-700 px-4 py-3 rounded-full text-sm font-medium transition hover:bg-gray-600">
                    üìñ Story
                </button>
                <button data-category="news" class="category-pill bg-gray-700 px-4 py-3 rounded-full text-sm font-medium transition hover:bg-gray-600">
                    üì∞ News
                </button>
                <button data-category="gossip" class="category-pill bg-gray-700 px-4 py-3 rounded-full text-sm font-medium transition hover:bg-gray-600">
                    üí¨ Gossip
                </button>
                <button data-category="music" class="category-pill bg-gray-700 px-4 py-3 rounded-full text-sm font-medium transition hover:bg-gray-600">
                    üéµ Music
                </button>
                <button data-category="general" class="category-pill bg-gray-700 px-4 py-3 rounded-full text-sm font-medium transition hover:bg-gray-600">
                    üìª General
                </button>
            </div>
        </div>
        
        <!-- Advanced Filters Toggle -->
        <div class="mb-4">
            <button id="advancedFiltersToggle" class="w-full bg-gray-700 hover:bg-gray-600 px-6 py-4 rounded-full transition text-base font-semibold flex items-center justify-center gap-2 min-h-[56px]">
                <span>‚öôÔ∏è Advanced Filters</span>
            </button>
        </div>
        
        <!-- Advanced Filters Panel (Collapsible) -->
        <div id="advancedFiltersPanel" class="bg-gray-800 rounded-lg space-y-3 mb-6" style="padding: 0;">
            <!-- Status Filter -->
            <div>
                <label class="block text-sm font-medium mb-2">Status</label>
                <select id="statusFilter" class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600 focus:outline-none focus:border-blue-500">
                    <option value="">All Status</option>
                    <option value="pending">Pending Review</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                </select>
            </div>
            
            <!-- Date Range Filter -->
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="block text-sm font-medium mb-2">From Date</label>
                    <input type="date" id="dateFromFilter" class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600 focus:outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">To Date</label>
                    <input type="date" id="dateToFilter" class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600 focus:outline-none focus:border-blue-500">
                </div>
            </div>
            
            <!-- Weather Type Filter (shown only when category=weather) -->
            <div id="weatherTypeFilterContainer" class="hidden">
                <label class="block text-sm font-medium mb-2">Weather Type</label>
                <select id="weatherTypeFilter" class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600 focus:outline-none focus:border-blue-500">
                    <option value="">All Weather Types</option>
                    <option value="sunny">‚òÄÔ∏è Sunny</option>
                    <option value="rainy">üåßÔ∏è Rainy</option>
                    <option value="cloudy">‚òÅÔ∏è Cloudy</option>
                    <option value="foggy">üå´Ô∏è Foggy</option>
                    <option value="rad storm">‚ò¢Ô∏è Rad Storm</option>
                    <option value="dust storm">üå™Ô∏è Dust Storm</option>
                    <option value="glowing fog">üíö Glowing Fog</option>
                </select>
            </div>
            
            <!-- Filter Actions -->
            <div class="flex gap-2 pt-2">
                <button id="applyAdvFilters" class="flex-1 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded transition font-medium">
                    Apply Filters
                </button>
                <button id="resetAdvFilters" class="bg-gray-600 hover:bg-gray-500 px-4 py-2 rounded transition font-medium">
                    Reset
                </button>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="flex flex-col gap-3">
            <button id="refreshBtn" class="w-full bg-blue-600 hover:bg-blue-700 px-8 py-4 rounded-full transition text-base font-semibold min-h-[56px]">
                üîÑ Refresh
            </button>
            <button id="statsBtn" class="w-full bg-green-600 hover:bg-green-700 px-8 py-4 rounded-full transition text-base font-semibold min-h-[56px]">
                üìä Stats
            </button>
            <button id="timelineViewBtn" class="w-full bg-purple-600 hover:bg-purple-700 px-8 py-4 rounded-full transition text-base font-semibold min-h-[56px] hidden">
                üìö Story Timelines
            </button>
        </div>
    </div>
    
    <!-- Header -->
    <header class="bg-gray-800 shadow-lg relative">
        <div class="container mx-auto px-4 py-4">
            <button id="hamburger" class="hamburger absolute left-4 top-1/2 -translate-y-1/2" aria-label="Open menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <h1 class="text-2xl font-bold text-center">üéôÔ∏è DJ Script Review</h1>
            <div id="stats" class="text-center text-sm text-gray-400 mt-2">
                Loading...
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        
        <!-- Card Container -->
        <div id="cardContainer" class="card-container">
            <div id="noScripts" class="text-center text-gray-400 hidden">
                <div class="text-6xl mb-4">‚úÖ</div>
                <p class="text-xl">All scripts reviewed!</p>
                <p class="mt-2">Great job! Click refresh to check for new scripts.</p>
            </div>
        </div>
        
        <!-- Swipe Hints -->
        <div id="swipeHints" class="swipe-hints text-center mt-6 text-sm text-gray-500 transition-opacity duration-500">
            <p>üëà Swipe left to reject | Swipe right to approve üëâ</p>
            <p class="mt-1">Keyboard: ‚Üê Reject | ‚Üí Approve</p>
        </div>
        
    </main>
    
    <!-- Rejection Modal -->
    <div id="rejectionModal" class="modal">
        <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-xl font-bold mb-4">Why reject this script?</h2>
            
            <select id="rejectionReason" class="w-full bg-gray-700 text-white px-4 py-2 rounded-lg mb-4 border border-gray-600 focus:outline-none focus:border-blue-500">
                <option value="">Select a reason...</option>
            </select>
            
            <textarea id="customComment" 
                      class="w-full bg-gray-700 text-white px-4 py-2 rounded-lg mb-4 border border-gray-600 focus:outline-none focus:border-blue-500 hidden" 
                      rows="3" 
                      placeholder="Please specify..."></textarea>
            
            <div class="flex gap-4">
                <button id="cancelReject" class="flex-1 bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg transition">
                    Cancel
                </button>
                <button id="confirmReject" class="flex-1 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition">
                    Confirm Reject
                </button>
            </div>
        </div>
    </div>
    
    <!-- Story Timeline View Modal -->
    <div id="timelineModal" class="modal">
        <div class="bg-gray-800 rounded-lg max-w-4xl w-full mx-4 shadow-2xl flex flex-col" style="max-height: 80vh;">
            <!-- Fixed Header -->
            <div class="flex justify-between items-center p-6 pb-4 bg-gray-800 border-b border-gray-700 flex-shrink-0">
                <h2 class="text-2xl font-bold">üìö Active Story Timelines</h2>
                <button id="closeTimelineView" aria-label="Close timeline view" class="modal-close text-gray-400 hover:text-white text-3xl leading-none flex items-center justify-center flex-shrink-0" style="min-width: 56px; min-height: 56px;">√ó</button>
            </div>
            
            <!-- Scrollable Content -->
            <div id="timelineContent" class="space-y-6 p-6 pt-4 overflow-y-auto flex-1">
                <p class="text-gray-400 text-center py-8">Loading story timelines...</p>
            </div>
        </div>
    </div>
    
    <!-- Stats Dashboard Modal -->
    <div id="statsModal" class="modal">
        <div class="bg-gray-800 rounded-lg max-w-4xl w-full mx-4 shadow-2xl flex flex-col" style="max-height: 80vh;">
            <!-- Sticky Header -->
            <div class="flex justify-between items-center p-6 pb-4 bg-gray-800 border-b border-gray-700 flex-shrink-0">
                <h2 class="text-2xl font-bold">üìä Review Statistics</h2>
                <button id="closeStatsView" aria-label="Close statistics modal" class="modal-close text-gray-400 hover:text-white text-3xl leading-none flex items-center justify-center flex-shrink-0" style="min-width: 56px; min-height: 56px;">√ó</button>
            </div>
            
            <!-- Scrollable Content -->
            <div id="statsContent" class="space-y-6 p-6 pt-4 overflow-y-auto flex-1">
                <p class="text-gray-400 text-center py-8">Loading statistics...</p>
            </div>
        </div>
    </div>
    
    <!-- Auth Modal - HIDDEN: No authentication needed for local use -->
    <div id="authModal" class="modal" style="display: none;">
        <div class="bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-xl font-bold mb-4">Enter API Token</h2>
            <p class="text-gray-400 mb-4">Please enter your API token to access the script review app.</p>
            
            <form id="loginForm" onsubmit="return false;">
                <input type="password" 
                       id="apiToken" 
                       name="token"
                       autocomplete="off"
                       class="w-full bg-gray-700 text-white px-4 py-2 rounded-lg mb-4 border border-gray-600 focus:outline-none focus:border-blue-500" 
                       placeholder="API Token"
                       aria-label="API Token">
                
                <button type="submit" id="loginBtn" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition">
                    Login
                </button>
            </form>
            
            <p class="text-xs text-gray-500 mt-4">
                Set SCRIPT_REVIEW_TOKEN in your environment to configure the token.
            </p>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Undo Toast -->
    <div id="undoToast" class="toast undo-toast" style="display: none;">
        <span id="undoMessage"></span>
        <button id="undoBtn" class="ml-4 px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded font-semibold">Undo</button>
    </div>
    
    <!-- Scripts -->
    <script src="/static/api.js?v=2"></script>
    <script src="/static/swipe.js?v=2"></script>
    <script src="/static/app.js?v=2"></script>
    
    <!-- Service Worker disabled for development -->
    <script>
        // Temporarily disable service worker to prevent caching issues during development
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
                for (let registration of registrations) {
                    registration.unregister();
                }
            });
        }
    </script>
</body>
</html>
